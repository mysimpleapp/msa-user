<link rel="import" href="/msa/msa.html"></link>
<template id="msa-admin-users">
	<h1>Users</h1>
	<table class="users">
		<thead><td>Name</td><td>Groups</td></thead>
	</table>
</template>
<script>
(function() {

	// methods
	var usersMethods = {}
	usersMethods.init = function() {
		this.listUsers()
	}
	usersMethods.sync = function() {
		const t = this.Q("table.users")
		for(let user of this.users){
			const r = t.insertRow()
			r.insertCell().textContent = user.name
			r.insertCell().textContent = user.groups.join(', ')
		}
	}
	usersMethods.listUsers = function() {
		Msa.get('/admin/users/list', users => {
			this.users = users
			this.sync()
		})
	}

	// actions
/*
	var loginActions = []
	loginActions.push({el:"button.login", evt:"click", act:function() {
		var name = this.Q(".unlogged input[name=username]").value,
			pass = this.Q(".unlogged input[name=pass]").value
		Msa.post('/user/login',
			{ header:{ Authorization: "Basic "+name+":"+pass }},
			function(user){
				if(user) location.reload()
			}
		)
	}})
	loginActions.push({el:"button.logout", evt:"click", act:function() {
		Msa.post('/user/logout', function() {
			location.reload()
		})
	}})
*/
	// register elements
	Msa.registerElement("msa-admin-users", {
		template: "#msa-admin-users",
		oncreate: function() {
			this.Q = Msa.Q
			Object.assign(this, usersMethods)
			this.users = []
//			Msa.addActions(this, usersActions)
		},
		onattach: function() {
			this.init()
		}
	})

	// various
/*
	var defArg = function() {
		for(var i=0, len=arguments.length; i<len; ++i) {
			var arg = arguments[i]
			if(arg!==undefined && arg!==null) return arg
		}
	}
*/
})()
</script>
